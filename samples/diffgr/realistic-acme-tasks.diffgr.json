{
  "format": "diffgr",
  "version": 1,
  "meta": {
    "title": "DiffGR realistic sample: Acme Tasks",
    "createdAt": "2026-02-23T09:52:19Z",
    "source": {
      "type": "git_compare",
      "base": "4bfecbad3648b9aebfa5400826f6f1230fc74837",
      "head": "6376c159f4ce411436769debd4c133e60bdae13a",
      "baseSha": "4bfecbad3648b9aebfa5400826f6f1230fc74837",
      "headSha": "6376c159f4ce411436769debd4c133e60bdae13a",
      "mergeBaseSha": "4bfecbad3648b9aebfa5400826f6f1230fc74837",
      "description": "Generated by scripts/generate_diffgr.py"
    },
    "x-sample": {
      "kind": "realistic",
      "project": "acme-tasks",
      "note": "Generated from a base/head snapshot to create varied, easy-to-read chunks."
    }
  },
  "groups": [
    {
      "id": "g-backend",
      "name": "Backend/API",
      "order": 1,
      "tags": [
        "backend"
      ]
    },
    {
      "id": "g-db",
      "name": "DB/Data",
      "order": 2,
      "tags": [
        "db"
      ]
    },
    {
      "id": "g-frontend",
      "name": "Frontend/UI",
      "order": 3,
      "tags": [
        "frontend"
      ]
    },
    {
      "id": "g-ci",
      "name": "CI/Tooling",
      "order": 4,
      "tags": [
        "ci"
      ]
    },
    {
      "id": "g-docs",
      "name": "Docs",
      "order": 5,
      "tags": [
        "docs"
      ]
    },
    {
      "id": "g-tests",
      "name": "Tests",
      "order": 6,
      "tags": [
        "tests"
      ]
    }
  ],
  "chunks": [
    {
      "id": "7f45e60cb31d89dca5cc3c8813866605d0b50658377d8b5ecf1da4e092689613",
      "filePath": "samples/realistic-pr-sim/.github/workflows/ci.yml",
      "old": {
        "start": 1,
        "count": 5
      },
      "new": {
        "start": 1,
        "count": 8
      },
      "lines": [
        {
          "kind": "context",
          "text": "name: ci",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "delete",
          "text": "on: [push, pull_request]",
          "oldLine": 2,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "on:",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "  push:",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "    branches: [\"main\"]",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "  pull_request:",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 3,
          "newLine": 6
        },
        {
          "kind": "context",
          "text": "jobs:",
          "oldLine": 4,
          "newLine": 7
        },
        {
          "kind": "context",
          "text": "  test:",
          "oldLine": 5,
          "newLine": 8
        }
      ],
      "fingerprints": {
        "stable": "dc8a145f7574d300b4897343569b62852738166cce9513b5d1636fa038595a9a",
        "strong": "7f45e60cb31d89dca5cc3c8813866605d0b50658377d8b5ecf1da4e092689613"
      }
    },
    {
      "id": "a8555a8b225e5a22b4a7bb4911bdf6cc2f6dc478bc7018ae141ab68fda06529d",
      "filePath": "samples/realistic-pr-sim/.github/workflows/ci.yml",
      "old": {
        "start": 9,
        "count": 5
      },
      "new": {
        "start": 12,
        "count": 8
      },
      "lines": [
        {
          "kind": "context",
          "text": "      - uses: actions/setup-node@v4",
          "oldLine": 9,
          "newLine": 12
        },
        {
          "kind": "context",
          "text": "        with:",
          "oldLine": 10,
          "newLine": 13
        },
        {
          "kind": "context",
          "text": "          node-version: 20",
          "oldLine": 11,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "          cache: \"npm\"",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "context",
          "text": "      - run: npm ci",
          "oldLine": 12,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "      - run: npm run lint",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "context",
          "text": "      - run: npm test",
          "oldLine": 13,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 19
        }
      ],
      "fingerprints": {
        "stable": "c406c6d87eee8eacd42a66a2ba8ce172774c6809009b0461a31b05981ced103f",
        "strong": "a8555a8b225e5a22b4a7bb4911bdf6cc2f6dc478bc7018ae141ab68fda06529d"
      },
      "header": "jobs:"
    },
    {
      "id": "a5064cd388c5a6825d1458ccf89fd20776db338437cdeb3788d392674e327a5d",
      "filePath": "samples/realistic-pr-sim/README.md",
      "old": {
        "start": 1,
        "count": 9
      },
      "new": {
        "start": 1,
        "count": 23
      },
      "lines": [
        {
          "kind": "delete",
          "text": "# Acme Tasks (sample)",
          "oldLine": 1,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "# Acme Tasks (DiffGR realistic sample)",
          "oldLine": null,
          "newLine": 1
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 2,
          "newLine": 2
        },
        {
          "kind": "delete",
          "text": "Tiny sample app used for diff viewing.",
          "oldLine": 3,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "This directory is a small, realistic-ish codebase snapshot used by DiffGR sample reports.",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 4,
          "newLine": 4
        },
        {
          "kind": "delete",
          "text": "Endpoints:",
          "oldLine": 5,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "- GET /health",
          "oldLine": 6,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "- POST /auth/login",
          "oldLine": 7,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "- GET /tasks",
          "oldLine": 8,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "It intentionally includes a mix of:",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "- backend routes and middleware",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "- a tiny in-memory \"db\" layer",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "- frontend TSX components",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "- CI workflow changes",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "- docs changes",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "add",
          "text": "The corresponding DiffGR JSON is under `samples/diffgr/`.",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "add",
          "text": "## Endpoints",
          "oldLine": null,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "- `GET /health`",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "- `POST /auth/login`",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "- `GET /tasks?limit=20&cursor=...`",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 19
        },
        {
          "kind": "add",
          "text": "## Notes",
          "oldLine": null,
          "newLine": 20
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 21
        },
        {
          "kind": "add",
          "text": "This is sample code for diff viewing only. It is not intended to be runnable as-is.",
          "oldLine": null,
          "newLine": 22
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 9,
          "newLine": 23
        }
      ],
      "fingerprints": {
        "stable": "ae938458dcbdb893b9706d9272a430dd140d9d0269cfba7c6e03e6b79bdf8bfc",
        "strong": "a5064cd388c5a6825d1458ccf89fd20776db338437cdeb3788d392674e327a5d"
      }
    },
    {
      "id": "bcce8a3bdf08296d463292b79cbe2ee6fcf52b467d00114dbabc9848ce6bec17",
      "filePath": "samples/realistic-pr-sim/package.json",
      "old": {
        "start": 1,
        "count": 18
      },
      "new": {
        "start": 1,
        "count": 21
      },
      "lines": [
        {
          "kind": "context",
          "text": "{",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "context",
          "text": "  \"name\": \"acme-tasks-sample\",",
          "oldLine": 2,
          "newLine": 2
        },
        {
          "kind": "context",
          "text": "  \"private\": true,",
          "oldLine": 3,
          "newLine": 3
        },
        {
          "kind": "delete",
          "text": "  \"version\": \"0.2.0\",",
          "oldLine": 4,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  \"version\": \"0.3.0\",",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "context",
          "text": "  \"type\": \"module\",",
          "oldLine": 5,
          "newLine": 5
        },
        {
          "kind": "context",
          "text": "  \"scripts\": {",
          "oldLine": 6,
          "newLine": 6
        },
        {
          "kind": "context",
          "text": "    \"build\": \"tsc -p tsconfig.json\",",
          "oldLine": 7,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "    \"lint\": \"eslint .\",",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "context",
          "text": "    \"test\": \"node --test\"",
          "oldLine": 8,
          "newLine": 9
        },
        {
          "kind": "context",
          "text": "  },",
          "oldLine": 9,
          "newLine": 10
        },
        {
          "kind": "context",
          "text": "  \"dependencies\": {",
          "oldLine": 10,
          "newLine": 11
        },
        {
          "kind": "delete",
          "text": "    \"express\": \"^4.18.2\"",
          "oldLine": 11,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "    \"express\": \"^4.18.3\"",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "context",
          "text": "  },",
          "oldLine": 12,
          "newLine": 13
        },
        {
          "kind": "context",
          "text": "  \"devDependencies\": {",
          "oldLine": 13,
          "newLine": 14
        },
        {
          "kind": "context",
          "text": "    \"@types/express\": \"^4.17.21\",",
          "oldLine": 14,
          "newLine": 15
        },
        {
          "kind": "context",
          "text": "    \"@types/node\": \"^20.11.0\",",
          "oldLine": 15,
          "newLine": 16
        },
        {
          "kind": "delete",
          "text": "    \"typescript\": \"^5.3.0\"",
          "oldLine": 16,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "    \"eslint\": \"^9.0.0\",",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "    \"typescript\": \"^5.4.0\"",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "context",
          "text": "  }",
          "oldLine": 17,
          "newLine": 19
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 18,
          "newLine": 20
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 21
        }
      ],
      "fingerprints": {
        "stable": "615a8571cf4295d7878d6d0446e3e77c22558f0031b636378abe36ed2773d1a7",
        "strong": "bcce8a3bdf08296d463292b79cbe2ee6fcf52b467d00114dbabc9848ce6bec17"
      }
    },
    {
      "id": "cb29178e6a9f8edcd007fea9f08527ab493011eb38c36207adf348d01cd02e3c",
      "filePath": "samples/realistic-pr-sim/src/db/index.ts",
      "old": {
        "start": 2,
        "count": 14
      },
      "new": {
        "start": 2,
        "count": 22
      },
      "lines": [
        {
          "kind": "context",
          "text": "  id: string;",
          "oldLine": 2,
          "newLine": 2
        },
        {
          "kind": "context",
          "text": "  title: string;",
          "oldLine": 3,
          "newLine": 3
        },
        {
          "kind": "context",
          "text": "  completed: boolean;",
          "oldLine": 4,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "  dueAt?: string;",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "context",
          "text": "};",
          "oldLine": 5,
          "newLine": 6
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 6,
          "newLine": 7
        },
        {
          "kind": "context",
          "text": "const tasks: Task[] = [",
          "oldLine": 7,
          "newLine": 8
        },
        {
          "kind": "delete",
          "text": "  { id: \"t-001\", title: \"Write docs\", completed: false },",
          "oldLine": 8,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  { id: \"t-001\", title: \"Write docs\", completed: false, dueAt: \"2026-03-01T12:00:00Z\" },",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "context",
          "text": "  { id: \"t-002\", title: \"Fix flaky test\", completed: true },",
          "oldLine": 9,
          "newLine": 10
        },
        {
          "kind": "delete",
          "text": "  { id: \"t-003\", title: \"Ship v0.2.0\", completed: false }",
          "oldLine": 10,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  { id: \"t-003\", title: \"Ship v0.3.0\", completed: false },",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "context",
          "text": "];",
          "oldLine": 11,
          "newLine": 12
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 12,
          "newLine": 13
        },
        {
          "kind": "delete",
          "text": "export function listTasks(): Task[] {",
          "oldLine": 13,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  return tasks;",
          "oldLine": 14,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "export type ListTasksResult = { items: Task[]; nextCursor: string | null };",
          "oldLine": null,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "export function listTasks(opts: { limit: number; cursor: string | null }): ListTasksResult {",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "  const start = cursor ? Math.max(0, tasks.findIndex((t) => t.id === cursor) + 1) : 0;",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "  const end = Math.min(tasks.length, start + opts.limit);",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "  const items = tasks.slice(start, end);",
          "oldLine": null,
          "newLine": 19
        },
        {
          "kind": "add",
          "text": "  const nextCursor = end >= tasks.length ? null : tasks[end - 1]?.id ?? null;",
          "oldLine": null,
          "newLine": 20
        },
        {
          "kind": "add",
          "text": "  return { items, nextCursor };",
          "oldLine": null,
          "newLine": 21
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 15,
          "newLine": 22
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 23
        }
      ],
      "fingerprints": {
        "stable": "9d817874308c4c5b933f290bc6cee202175e53223041bc56519f00347fc68b3e",
        "strong": "cb29178e6a9f8edcd007fea9f08527ab493011eb38c36207adf348d01cd02e3c"
      },
      "header": "export type Task = {"
    },
    {
      "id": "ab0b161e4100a120e1c0776b1f409005622bb2adde44e100a4c279794571fb9e",
      "filePath": "samples/realistic-pr-sim/src/lib/logger.ts",
      "old": {
        "start": 1,
        "count": 10
      },
      "new": {
        "start": 1,
        "count": 24
      },
      "lines": [
        {
          "kind": "context",
          "text": "import type { Request } from \"express\";",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 2,
          "newLine": 2
        },
        {
          "kind": "delete",
          "text": "export function log(message: string): void {",
          "oldLine": 3,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\";",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "export function log(level: LogLevel, message: string, meta: Record<string, unknown> = {}): void {",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "  const payload = {",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "    level,",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "    message,",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "    ...meta,",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "    at: new Date().toISOString(),",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "  };",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "context",
          "text": "  // eslint-disable-next-line no-console",
          "oldLine": 4,
          "newLine": 12
        },
        {
          "kind": "delete",
          "text": "  console.log(message);",
          "oldLine": 5,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  console.log(JSON.stringify(payload));",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 6,
          "newLine": 14
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 7,
          "newLine": 15
        },
        {
          "kind": "context",
          "text": "export function requestMeta(req: Request): Record<string, unknown> {",
          "oldLine": 8,
          "newLine": 16
        },
        {
          "kind": "delete",
          "text": "  return { method: req.method, path: req.path };",
          "oldLine": 9,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  const anyReq = req as Request & { requestId?: string };",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "  return {",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "    requestId: anyReq.requestId,",
          "oldLine": null,
          "newLine": 19
        },
        {
          "kind": "add",
          "text": "    method: req.method,",
          "oldLine": null,
          "newLine": 20
        },
        {
          "kind": "add",
          "text": "    path: req.path,",
          "oldLine": null,
          "newLine": 21
        },
        {
          "kind": "add",
          "text": "  };",
          "oldLine": null,
          "newLine": 22
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 10,
          "newLine": 23
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 24
        }
      ],
      "fingerprints": {
        "stable": "571027d1c868c464248209d1ee55d25092b8b447c99f578b28a9cce8f9c9d18c",
        "strong": "ab0b161e4100a120e1c0776b1f409005622bb2adde44e100a4c279794571fb9e"
      }
    },
    {
      "id": "a60cc56b56d5a34357c6aad93646d5816863e7f2fc525488c357d2579f270d77",
      "filePath": "samples/realistic-pr-sim/src/lib/requestId.ts",
      "old": {
        "start": 0,
        "count": 0
      },
      "new": {
        "start": 1,
        "count": 14
      },
      "lines": [
        {
          "kind": "add",
          "text": "import crypto from \"node:crypto\";",
          "oldLine": null,
          "newLine": 1
        },
        {
          "kind": "add",
          "text": "import type { NextFunction, Request, Response } from \"express\";",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "export type RequestWithId = Request & { requestId?: string };",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "export function requestIdMiddleware(req: RequestWithId, _res: Response, next: NextFunction): void {",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "  // Prefer crypto.randomUUID() when available, fall back to random bytes.",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "  req.requestId =",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "    typeof crypto.randomUUID === \"function\"",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "      ? crypto.randomUUID()",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "      : crypto.randomBytes(16).toString(\"hex\");",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "add",
          "text": "  next();",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "}",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 14
        }
      ],
      "fingerprints": {
        "stable": "1c4c1fc9ecf7d18781edae41d2d8302a9a7f0d19704fd3d3376f3a20ea1bc2d8",
        "strong": "a60cc56b56d5a34357c6aad93646d5816863e7f2fc525488c357d2579f270d77"
      }
    },
    {
      "id": "970dcd3fbfbdb7d0ff0b2efc60b9dad4dab6b176394f9c6114514e6bd4c4e0cd",
      "filePath": "samples/realistic-pr-sim/src/lib/validate.ts",
      "old": {
        "start": 1,
        "count": 10
      },
      "new": {
        "start": 1,
        "count": 26
      },
      "lines": [
        {
          "kind": "context",
          "text": "export function parseIntStrict(value: string, fallback: number): number {",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "delete",
          "text": "  const n = Number(value);",
          "oldLine": 2,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  return Number.isInteger(n) ? n : fallback;",
          "oldLine": 3,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  const trimmed = value.trim();",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "  if (trimmed === \"\") return fallback;",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "  const n = Number(trimmed);",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "  if (!Number.isInteger(n)) return fallback;",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "  return n;",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "}",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "export function clamp(value: number, min: number, max: number): number {",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "  if (Number.isNaN(value)) return min;",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "  return Math.max(min, Math.min(max, value));",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 4,
          "newLine": 12
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 5,
          "newLine": 13
        },
        {
          "kind": "context",
          "text": "export function ensureNonEmpty(value: unknown, field: string): string {",
          "oldLine": 6,
          "newLine": 14
        },
        {
          "kind": "delete",
          "text": "  if (typeof value !== \"string\") throw new Error(field + \": must be string\");",
          "oldLine": 7,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  if (!value) throw new Error(field + \": required\");",
          "oldLine": 8,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  return value;",
          "oldLine": 9,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  if (typeof value !== \"string\") throw new Error(`${field}: must be string`);",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "  const trimmed = value.trim();",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "  if (!trimmed) throw new Error(`${field}: required`);",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "  return trimmed;",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 10,
          "newLine": 19
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 20
        },
        {
          "kind": "add",
          "text": "export function ensureEmail(value: unknown, field: string): string {",
          "oldLine": null,
          "newLine": 21
        },
        {
          "kind": "add",
          "text": "  const email = ensureNonEmpty(value, field);",
          "oldLine": null,
          "newLine": 22
        },
        {
          "kind": "add",
          "text": "  if (!email.includes(\"@\") || email.includes(\" \")) throw new Error(`${field}: invalid email`);",
          "oldLine": null,
          "newLine": 23
        },
        {
          "kind": "add",
          "text": "  return email.toLowerCase();",
          "oldLine": null,
          "newLine": 24
        },
        {
          "kind": "add",
          "text": "}",
          "oldLine": null,
          "newLine": 25
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 26
        }
      ],
      "fingerprints": {
        "stable": "dab8ea4cb2b44ff93183299e331eea3d35a36e823a644f064f6fa4b038e72d0d",
        "strong": "970dcd3fbfbdb7d0ff0b2efc60b9dad4dab6b176394f9c6114514e6bd4c4e0cd"
      }
    },
    {
      "id": "72c76fe217d4fbe9f2fdf77ade83f09ba87a5044c9b5cacdf953f8cdb86fe1ae",
      "filePath": "samples/realistic-pr-sim/src/routes/auth.ts",
      "old": {
        "start": 1,
        "count": 12
      },
      "new": {
        "start": 1,
        "count": 42
      },
      "lines": [
        {
          "kind": "context",
          "text": "import type { Request, Response } from \"express\";",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "delete",
          "text": "import { ensureNonEmpty } from \"../lib/validate.js\";",
          "oldLine": 2,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "import { ensureEmail, ensureNonEmpty } from \"../lib/validate.js\";",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "import { log, requestMeta } from \"../lib/logger.js\";",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "const attemptsByIp = new Map<string, { count: number; resetAt: number }>();",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "function allowLoginAttempt(ip: string): boolean {",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "  const now = Date.now();",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "  const windowMs = 10_000;",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "  const maxAttempts = 5;",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "  const current = attemptsByIp.get(ip);",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "add",
          "text": "  if (!current || current.resetAt < now) {",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "    attemptsByIp.set(ip, { count: 1, resetAt: now + windowMs });",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "add",
          "text": "    return true;",
          "oldLine": null,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "  }",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "  current.count += 1;",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "  return current.count <= maxAttempts;",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "}",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 3,
          "newLine": 19
        },
        {
          "kind": "context",
          "text": "export function postLogin(req: Request, res: Response): void {",
          "oldLine": 4,
          "newLine": 20
        },
        {
          "kind": "delete",
          "text": "  const email = ensureNonEmpty((req.body || {}).email, \"email\");",
          "oldLine": 5,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  const password = ensureNonEmpty((req.body || {}).password, \"password\");",
          "oldLine": 6,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  if (password.length < 8) {",
          "oldLine": 7,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "    res.status(401).json({ error: \"invalid_credentials\" });",
          "oldLine": 8,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  const ip = req.ip || \"unknown\";",
          "oldLine": null,
          "newLine": 21
        },
        {
          "kind": "add",
          "text": "  if (!allowLoginAttempt(ip)) {",
          "oldLine": null,
          "newLine": 22
        },
        {
          "kind": "add",
          "text": "    log(\"warn\", \"rate_limited\", { ...requestMeta(req), ip });",
          "oldLine": null,
          "newLine": 23
        },
        {
          "kind": "add",
          "text": "    res.status(429).json({ error: \"too_many_attempts\" });",
          "oldLine": null,
          "newLine": 24
        },
        {
          "kind": "context",
          "text": "    return;",
          "oldLine": 9,
          "newLine": 25
        },
        {
          "kind": "context",
          "text": "  }",
          "oldLine": 10,
          "newLine": 26
        },
        {
          "kind": "delete",
          "text": "  res.json({ token: `fake-jwt-for:${String(email).toLowerCase()}` });",
          "oldLine": 11,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 27
        },
        {
          "kind": "add",
          "text": "  try {",
          "oldLine": null,
          "newLine": 28
        },
        {
          "kind": "add",
          "text": "    const email = ensureEmail((req.body || {}).email, \"email\");",
          "oldLine": null,
          "newLine": 29
        },
        {
          "kind": "add",
          "text": "    const password = ensureNonEmpty((req.body || {}).password, \"password\");",
          "oldLine": null,
          "newLine": 30
        },
        {
          "kind": "add",
          "text": "    const ok = password.length >= 8;",
          "oldLine": null,
          "newLine": 31
        },
        {
          "kind": "add",
          "text": "    if (!ok) {",
          "oldLine": null,
          "newLine": 32
        },
        {
          "kind": "add",
          "text": "      res.status(401).json({ error: \"invalid_credentials\" });",
          "oldLine": null,
          "newLine": 33
        },
        {
          "kind": "add",
          "text": "      return;",
          "oldLine": null,
          "newLine": 34
        },
        {
          "kind": "add",
          "text": "    }",
          "oldLine": null,
          "newLine": 35
        },
        {
          "kind": "add",
          "text": "    res.json({ token: `fake-jwt-for:${email}` });",
          "oldLine": null,
          "newLine": 36
        },
        {
          "kind": "add",
          "text": "  } catch (err) {",
          "oldLine": null,
          "newLine": 37
        },
        {
          "kind": "add",
          "text": "    log(\"info\", \"bad_request\", { ...requestMeta(req), err: String(err) });",
          "oldLine": null,
          "newLine": 38
        },
        {
          "kind": "add",
          "text": "    res.status(400).json({ error: \"bad_request\" });",
          "oldLine": null,
          "newLine": 39
        },
        {
          "kind": "add",
          "text": "  }",
          "oldLine": null,
          "newLine": 40
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 12,
          "newLine": 41
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 42
        }
      ],
      "fingerprints": {
        "stable": "f683415ef45100d9f90240b98925cb9106305685fb08419a11d011086f966830",
        "strong": "72c76fe217d4fbe9f2fdf77ade83f09ba87a5044c9b5cacdf953f8cdb86fe1ae"
      }
    },
    {
      "id": "0cfc819989c8f5031811792827367fe141ee21609ab77520e3c26e7a6837f3dd",
      "filePath": "samples/realistic-pr-sim/src/routes/tasks.ts",
      "old": {
        "start": 1,
        "count": 6
      },
      "new": {
        "start": 1,
        "count": 13
      },
      "lines": [
        {
          "kind": "context",
          "text": "import type { Request, Response } from \"express\";",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "context",
          "text": "import { listTasks } from \"../db/index.js\";",
          "oldLine": 2,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "import { clamp, parseIntStrict } from \"../lib/validate.js\";",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 3,
          "newLine": 4
        },
        {
          "kind": "delete",
          "text": "export function getTasks(_req: Request, res: Response): void {",
          "oldLine": 4,
          "newLine": null
        },
        {
          "kind": "delete",
          "text": "  res.json({ items: listTasks(), nextCursor: null });",
          "oldLine": 5,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "export function getTasks(req: Request, res: Response): void {",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "  const rawLimit = String(req.query.limit ?? \"20\");",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "  const limit = clamp(parseIntStrict(rawLimit, 20), 1, 100);",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "  const cursor = typeof req.query.cursor === \"string\" ? req.query.cursor : null;",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "  const result = listTasks({ limit, cursor });",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "  res.json(result);",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 6,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 13
        }
      ],
      "fingerprints": {
        "stable": "bde7f6afe963b2047e57d663ea8db905d6e05ff7dae0da4f2ade27b1cdf7a5a9",
        "strong": "0cfc819989c8f5031811792827367fe141ee21609ab77520e3c26e7a6837f3dd"
      }
    },
    {
      "id": "33d3695c0dcf90ba4b6e4bbd274daf289710d4bdb738c438df23c2c74ec3f998",
      "filePath": "samples/realistic-pr-sim/src/server.ts",
      "old": {
        "start": 1,
        "count": 19
      },
      "new": {
        "start": 1,
        "count": 45
      },
      "lines": [
        {
          "kind": "context",
          "text": "import express from \"express\";",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "add",
          "text": "import { requestIdMiddleware } from \"./lib/requestId.js\";",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "import { log, requestMeta } from \"./lib/logger.js\";",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "context",
          "text": "import { getTasks } from \"./routes/tasks.js\";",
          "oldLine": 2,
          "newLine": 4
        },
        {
          "kind": "context",
          "text": "import { postLogin } from \"./routes/auth.js\";",
          "oldLine": 3,
          "newLine": 5
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 4,
          "newLine": 6
        },
        {
          "kind": "context",
          "text": "export function buildApp() {",
          "oldLine": 5,
          "newLine": 7
        },
        {
          "kind": "context",
          "text": "  const app = express();",
          "oldLine": 6,
          "newLine": 8
        },
        {
          "kind": "delete",
          "text": "  app.use(express.json());",
          "oldLine": 7,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  app.disable(\"x-powered-by\");",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "  app.use(express.json({ limit: \"64kb\" }));",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "add",
          "text": "  app.use(requestIdMiddleware);",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "  app.use((req, res, next) => {",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "add",
          "text": "    const start = Date.now();",
          "oldLine": null,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "    res.on(\"finish\", () => {",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "      log(\"info\", \"request\", { ...requestMeta(req), status: res.statusCode, ms: Date.now() - start });",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "    });",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "    next();",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "  });",
          "oldLine": null,
          "newLine": 19
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 8,
          "newLine": 20
        },
        {
          "kind": "context",
          "text": "  app.get(\"/health\", (_req, res) => res.json({ ok: true }));",
          "oldLine": 9,
          "newLine": 21
        },
        {
          "kind": "context",
          "text": "  app.post(\"/auth/login\", postLogin);",
          "oldLine": 10,
          "newLine": 22
        },
        {
          "kind": "context",
          "text": "  app.get(\"/tasks\", getTasks);",
          "oldLine": 11,
          "newLine": 23
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 12,
          "newLine": 24
        },
        {
          "kind": "add",
          "text": "  app.use((err: unknown, req: express.Request, res: express.Response, _next: express.NextFunction) => {",
          "oldLine": null,
          "newLine": 25
        },
        {
          "kind": "add",
          "text": "    log(\"error\", \"unhandled_error\", { ...requestMeta(req), err: String(err) });",
          "oldLine": null,
          "newLine": 26
        },
        {
          "kind": "add",
          "text": "    res.status(500).json({ error: \"internal_error\" });",
          "oldLine": null,
          "newLine": 27
        },
        {
          "kind": "add",
          "text": "  });",
          "oldLine": null,
          "newLine": 28
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 29
        },
        {
          "kind": "context",
          "text": "  return app;",
          "oldLine": 13,
          "newLine": 30
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 14,
          "newLine": 31
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 15,
          "newLine": 32
        },
        {
          "kind": "context",
          "text": "export async function startServer(port: number): Promise<void> {",
          "oldLine": 16,
          "newLine": 33
        },
        {
          "kind": "context",
          "text": "  const app = buildApp();",
          "oldLine": 17,
          "newLine": 34
        },
        {
          "kind": "delete",
          "text": "  app.listen(port);",
          "oldLine": 18,
          "newLine": null
        },
        {
          "kind": "add",
          "text": "  const server = app.listen(port);",
          "oldLine": null,
          "newLine": 35
        },
        {
          "kind": "add",
          "text": "  log(\"info\", \"listening\", { port });",
          "oldLine": null,
          "newLine": 36
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 37
        },
        {
          "kind": "add",
          "text": "  const shutdown = async (signal: string) => {",
          "oldLine": null,
          "newLine": 38
        },
        {
          "kind": "add",
          "text": "    log(\"warn\", \"shutdown\", { signal });",
          "oldLine": null,
          "newLine": 39
        },
        {
          "kind": "add",
          "text": "    server.close();",
          "oldLine": null,
          "newLine": 40
        },
        {
          "kind": "add",
          "text": "  };",
          "oldLine": null,
          "newLine": 41
        },
        {
          "kind": "add",
          "text": "  process.on(\"SIGINT\", () => void shutdown(\"SIGINT\"));",
          "oldLine": null,
          "newLine": 42
        },
        {
          "kind": "add",
          "text": "  process.on(\"SIGTERM\", () => void shutdown(\"SIGTERM\"));",
          "oldLine": null,
          "newLine": 43
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 19,
          "newLine": 44
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 45
        }
      ],
      "fingerprints": {
        "stable": "bdf422f974989b480230ddec968d7e926e44166ff0de3ed5a2a1725fae238392",
        "strong": "33d3695c0dcf90ba4b6e4bbd274daf289710d4bdb738c438df23c2c74ec3f998"
      }
    },
    {
      "id": "34f25fd9d6b0a4aaf9846a1960e078cf55cd57a7c6ba4843a661e694ac3ab702",
      "filePath": "samples/realistic-pr-sim/src/ui/components/Toast.tsx",
      "old": {
        "start": 0,
        "count": 0
      },
      "new": {
        "start": 1,
        "count": 21
      },
      "lines": [
        {
          "kind": "add",
          "text": "import React from \"react\";",
          "oldLine": null,
          "newLine": 1
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "export type ToastVariant = \"success\" | \"error\" | \"info\";",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "export function Toast(props: { variant: ToastVariant; message: string; onClose: () => void }) {",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "  const { variant, message, onClose } = props;",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "  React.useEffect(() => {",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "    const id = window.setTimeout(() => onClose(), 3000);",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "    return () => window.clearTimeout(id);",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "  }, [onClose]);",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "add",
          "text": "  return (",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "    <div role=\"status\" data-variant={variant}>",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "add",
          "text": "      <span>{message}</span>",
          "oldLine": null,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "      <button type=\"button\" onClick={onClose}>",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "        Close",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "      </button>",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "    </div>",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "  );",
          "oldLine": null,
          "newLine": 19
        },
        {
          "kind": "add",
          "text": "}",
          "oldLine": null,
          "newLine": 20
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 21
        }
      ],
      "fingerprints": {
        "stable": "91d77509e43e6c7226e75f36cbfa2830c980200279490d29e216bba4da981bb8",
        "strong": "34f25fd9d6b0a4aaf9846a1960e078cf55cd57a7c6ba4843a661e694ac3ab702"
      }
    },
    {
      "id": "f3e31225977c3d2723c484b33e0ee8f71d94214a8e2e77381406a0e249a9d92d",
      "filePath": "samples/realistic-pr-sim/src/ui/pages/SettingsPage.tsx",
      "old": {
        "start": 1,
        "count": 7
      },
      "new": {
        "start": 1,
        "count": 23
      },
      "lines": [
        {
          "kind": "context",
          "text": "import React from \"react\";",
          "oldLine": 1,
          "newLine": 1
        },
        {
          "kind": "add",
          "text": "import { Toast } from \"../components/Toast.js\";",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 2,
          "newLine": 3
        },
        {
          "kind": "context",
          "text": "export function SettingsPage() {",
          "oldLine": 3,
          "newLine": 4
        },
        {
          "kind": "context",
          "text": "  const [enableAnalytics, setEnableAnalytics] = React.useState(false);",
          "oldLine": 4,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "  const [saving, setSaving] = React.useState(false);",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "  const [toast, setToast] = React.useState<null | { variant: \"success\" | \"error\"; message: string }>(null);",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "  const save = async () => {",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "    setSaving(true);",
          "oldLine": null,
          "newLine": 10
        },
        {
          "kind": "add",
          "text": "    try {",
          "oldLine": null,
          "newLine": 11
        },
        {
          "kind": "add",
          "text": "      // Pretend to persist settings.",
          "oldLine": null,
          "newLine": 12
        },
        {
          "kind": "add",
          "text": "      await new Promise((r) => window.setTimeout(r, 150));",
          "oldLine": null,
          "newLine": 13
        },
        {
          "kind": "add",
          "text": "      setToast({ variant: \"success\", message: \"Saved\" });",
          "oldLine": null,
          "newLine": 14
        },
        {
          "kind": "add",
          "text": "    } catch {",
          "oldLine": null,
          "newLine": 15
        },
        {
          "kind": "add",
          "text": "      setToast({ variant: \"error\", message: \"Save failed\" });",
          "oldLine": null,
          "newLine": 16
        },
        {
          "kind": "add",
          "text": "    } finally {",
          "oldLine": null,
          "newLine": 17
        },
        {
          "kind": "add",
          "text": "      setSaving(false);",
          "oldLine": null,
          "newLine": 18
        },
        {
          "kind": "add",
          "text": "    }",
          "oldLine": null,
          "newLine": 19
        },
        {
          "kind": "add",
          "text": "  };",
          "oldLine": null,
          "newLine": 20
        },
        {
          "kind": "context",
          "text": "",
          "oldLine": 5,
          "newLine": 21
        },
        {
          "kind": "context",
          "text": "  return (",
          "oldLine": 6,
          "newLine": 22
        },
        {
          "kind": "context",
          "text": "    <section>",
          "oldLine": 7,
          "newLine": 23
        }
      ],
      "fingerprints": {
        "stable": "3b6b5d6cfc6cc3c17ce6ddeffc61d4623a1b2474aca946945bcf8fcf1b78ac5a",
        "strong": "f3e31225977c3d2723c484b33e0ee8f71d94214a8e2e77381406a0e249a9d92d"
      }
    },
    {
      "id": "124d6d8378311ef9fa483a4f4f404efea9c257e9ed45e9dc69d42e32569a9300",
      "filePath": "samples/realistic-pr-sim/src/ui/pages/SettingsPage.tsx",
      "old": {
        "start": 14,
        "count": 6
      },
      "new": {
        "start": 30,
        "count": 14
      },
      "lines": [
        {
          "kind": "context",
          "text": "        />",
          "oldLine": 14,
          "newLine": 30
        },
        {
          "kind": "context",
          "text": "        Enable analytics",
          "oldLine": 15,
          "newLine": 31
        },
        {
          "kind": "context",
          "text": "      </label>",
          "oldLine": 16,
          "newLine": 32
        },
        {
          "kind": "add",
          "text": "      <div>",
          "oldLine": null,
          "newLine": 33
        },
        {
          "kind": "add",
          "text": "        <button type=\"button\" onClick={save} disabled={saving}>",
          "oldLine": null,
          "newLine": 34
        },
        {
          "kind": "add",
          "text": "          {saving ? \"Saving...\" : \"Save\"}",
          "oldLine": null,
          "newLine": 35
        },
        {
          "kind": "add",
          "text": "        </button>",
          "oldLine": null,
          "newLine": 36
        },
        {
          "kind": "add",
          "text": "      </div>",
          "oldLine": null,
          "newLine": 37
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 38
        },
        {
          "kind": "add",
          "text": "      {toast ? <Toast variant={toast.variant} message={toast.message} onClose={() => setToast(null)} /> : null}",
          "oldLine": null,
          "newLine": 39
        },
        {
          "kind": "context",
          "text": "    </section>",
          "oldLine": 17,
          "newLine": 40
        },
        {
          "kind": "context",
          "text": "  );",
          "oldLine": 18,
          "newLine": 41
        },
        {
          "kind": "context",
          "text": "}",
          "oldLine": 19,
          "newLine": 42
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 43
        }
      ],
      "fingerprints": {
        "stable": "56cd5faae61ace3590aef1d525bbb846f43fcd64d0ee0a1aa6a644b80ebab62c",
        "strong": "124d6d8378311ef9fa483a4f4f404efea9c257e9ed45e9dc69d42e32569a9300"
      },
      "header": "export function SettingsPage() {"
    },
    {
      "id": "17321a7b61485f4558832c19c7a24352cd2f5cd11bb4761ded6cb898b1a9680d",
      "filePath": "samples/realistic-pr-sim/tests/routes.test.ts",
      "old": {
        "start": 0,
        "count": 0
      },
      "new": {
        "start": 1,
        "count": 10
      },
      "lines": [
        {
          "kind": "add",
          "text": "import assert from \"node:assert/strict\";",
          "oldLine": null,
          "newLine": 1
        },
        {
          "kind": "add",
          "text": "import test from \"node:test\";",
          "oldLine": null,
          "newLine": 2
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 3
        },
        {
          "kind": "add",
          "text": "test(\"smoke: list tasks shape\", async () => {",
          "oldLine": null,
          "newLine": 4
        },
        {
          "kind": "add",
          "text": "  // Sample test file used for diffs; not executed in this repo.",
          "oldLine": null,
          "newLine": 5
        },
        {
          "kind": "add",
          "text": "  const body = { items: [{ id: \"t-001\", title: \"x\", completed: false }], nextCursor: null };",
          "oldLine": null,
          "newLine": 6
        },
        {
          "kind": "add",
          "text": "  assert.equal(Array.isArray(body.items), true);",
          "oldLine": null,
          "newLine": 7
        },
        {
          "kind": "add",
          "text": "  assert.equal(typeof body.nextCursor === \"string\" || body.nextCursor === null, true);",
          "oldLine": null,
          "newLine": 8
        },
        {
          "kind": "add",
          "text": "});",
          "oldLine": null,
          "newLine": 9
        },
        {
          "kind": "add",
          "text": "",
          "oldLine": null,
          "newLine": 10
        }
      ],
      "fingerprints": {
        "stable": "618c645ef2cae0a7d8f6b4c4923bf4217a6ae5fe4068f08d25c7f75a7037ea4e",
        "strong": "17321a7b61485f4558832c19c7a24352cd2f5cd11bb4761ded6cb898b1a9680d"
      }
    }
  ],
  "assignments": {
    "g-backend": [
      "ab0b161e4100a120e1c0776b1f409005622bb2adde44e100a4c279794571fb9e",
      "a60cc56b56d5a34357c6aad93646d5816863e7f2fc525488c357d2579f270d77",
      "970dcd3fbfbdb7d0ff0b2efc60b9dad4dab6b176394f9c6114514e6bd4c4e0cd",
      "72c76fe217d4fbe9f2fdf77ade83f09ba87a5044c9b5cacdf953f8cdb86fe1ae",
      "0cfc819989c8f5031811792827367fe141ee21609ab77520e3c26e7a6837f3dd",
      "33d3695c0dcf90ba4b6e4bbd274daf289710d4bdb738c438df23c2c74ec3f998"
    ],
    "g-db": [
      "cb29178e6a9f8edcd007fea9f08527ab493011eb38c36207adf348d01cd02e3c"
    ],
    "g-frontend": [
      "34f25fd9d6b0a4aaf9846a1960e078cf55cd57a7c6ba4843a661e694ac3ab702",
      "f3e31225977c3d2723c484b33e0ee8f71d94214a8e2e77381406a0e249a9d92d",
      "124d6d8378311ef9fa483a4f4f404efea9c257e9ed45e9dc69d42e32569a9300"
    ],
    "g-ci": [
      "7f45e60cb31d89dca5cc3c8813866605d0b50658377d8b5ecf1da4e092689613",
      "a8555a8b225e5a22b4a7bb4911bdf6cc2f6dc478bc7018ae141ab68fda06529d",
      "bcce8a3bdf08296d463292b79cbe2ee6fcf52b467d00114dbabc9848ce6bec17"
    ],
    "g-docs": [
      "a5064cd388c5a6825d1458ccf89fd20776db338437cdeb3788d392674e327a5d"
    ],
    "g-tests": [
      "17321a7b61485f4558832c19c7a24352cd2f5cd11bb4761ded6cb898b1a9680d"
    ]
  },
  "reviews": {},
  "patch": "diff --git a/samples/realistic-pr-sim/.github/workflows/ci.yml b/samples/realistic-pr-sim/.github/workflows/ci.yml\nindex 9198940..a2a0135 100644\n--- a/samples/realistic-pr-sim/.github/workflows/ci.yml\n+++ b/samples/realistic-pr-sim/.github/workflows/ci.yml\n@@ -1,5 +1,8 @@\n name: ci\n-on: [push, pull_request]\n+on:\n+  push:\n+    branches: [\"main\"]\n+  pull_request:\n \n jobs:\n   test:\n@@ -9,5 +12,8 @@ jobs:\n       - uses: actions/setup-node@v4\n         with:\n           node-version: 20\n+          cache: \"npm\"\n       - run: npm ci\n+      - run: npm run lint\n       - run: npm test\n+\ndiff --git a/samples/realistic-pr-sim/README.md b/samples/realistic-pr-sim/README.md\nindex 820bd7d..95d2e50 100644\n--- a/samples/realistic-pr-sim/README.md\n+++ b/samples/realistic-pr-sim/README.md\n@@ -1,9 +1,23 @@\n-# Acme Tasks (sample)\n+# Acme Tasks (DiffGR realistic sample)\n \n-Tiny sample app used for diff viewing.\n+This directory is a small, realistic-ish codebase snapshot used by DiffGR sample reports.\n \n-Endpoints:\n-- GET /health\n-- POST /auth/login\n-- GET /tasks\n+It intentionally includes a mix of:\n+- backend routes and middleware\n+- a tiny in-memory \"db\" layer\n+- frontend TSX components\n+- CI workflow changes\n+- docs changes\n+\n+The corresponding DiffGR JSON is under `samples/diffgr/`.\n+\n+## Endpoints\n+\n+- `GET /health`\n+- `POST /auth/login`\n+- `GET /tasks?limit=20&cursor=...`\n+\n+## Notes\n+\n+This is sample code for diff viewing only. It is not intended to be runnable as-is.\n \ndiff --git a/samples/realistic-pr-sim/package.json b/samples/realistic-pr-sim/package.json\nindex b027ba0..5281aa5 100644\n--- a/samples/realistic-pr-sim/package.json\n+++ b/samples/realistic-pr-sim/package.json\n@@ -1,18 +1,21 @@\n {\n   \"name\": \"acme-tasks-sample\",\n   \"private\": true,\n-  \"version\": \"0.2.0\",\n+  \"version\": \"0.3.0\",\n   \"type\": \"module\",\n   \"scripts\": {\n     \"build\": \"tsc -p tsconfig.json\",\n+    \"lint\": \"eslint .\",\n     \"test\": \"node --test\"\n   },\n   \"dependencies\": {\n-    \"express\": \"^4.18.2\"\n+    \"express\": \"^4.18.3\"\n   },\n   \"devDependencies\": {\n     \"@types/express\": \"^4.17.21\",\n     \"@types/node\": \"^20.11.0\",\n-    \"typescript\": \"^5.3.0\"\n+    \"eslint\": \"^9.0.0\",\n+    \"typescript\": \"^5.4.0\"\n   }\n }\n+\ndiff --git a/samples/realistic-pr-sim/src/db/index.ts b/samples/realistic-pr-sim/src/db/index.ts\nindex afdd0e0..1c66701 100644\n--- a/samples/realistic-pr-sim/src/db/index.ts\n+++ b/samples/realistic-pr-sim/src/db/index.ts\n@@ -2,14 +2,22 @@ export type Task = {\n   id: string;\n   title: string;\n   completed: boolean;\n+  dueAt?: string;\n };\n \n const tasks: Task[] = [\n-  { id: \"t-001\", title: \"Write docs\", completed: false },\n+  { id: \"t-001\", title: \"Write docs\", completed: false, dueAt: \"2026-03-01T12:00:00Z\" },\n   { id: \"t-002\", title: \"Fix flaky test\", completed: true },\n-  { id: \"t-003\", title: \"Ship v0.2.0\", completed: false }\n+  { id: \"t-003\", title: \"Ship v0.3.0\", completed: false },\n ];\n \n-export function listTasks(): Task[] {\n-  return tasks;\n+export type ListTasksResult = { items: Task[]; nextCursor: string | null };\n+\n+export function listTasks(opts: { limit: number; cursor: string | null }): ListTasksResult {\n+  const start = cursor ? Math.max(0, tasks.findIndex((t) => t.id === cursor) + 1) : 0;\n+  const end = Math.min(tasks.length, start + opts.limit);\n+  const items = tasks.slice(start, end);\n+  const nextCursor = end >= tasks.length ? null : tasks[end - 1]?.id ?? null;\n+  return { items, nextCursor };\n }\n+\ndiff --git a/samples/realistic-pr-sim/src/lib/logger.ts b/samples/realistic-pr-sim/src/lib/logger.ts\nindex acd925d..baf8efb 100644\n--- a/samples/realistic-pr-sim/src/lib/logger.ts\n+++ b/samples/realistic-pr-sim/src/lib/logger.ts\n@@ -1,10 +1,24 @@\n import type { Request } from \"express\";\n \n-export function log(message: string): void {\n+type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\";\n+\n+export function log(level: LogLevel, message: string, meta: Record<string, unknown> = {}): void {\n+  const payload = {\n+    level,\n+    message,\n+    ...meta,\n+    at: new Date().toISOString(),\n+  };\n   // eslint-disable-next-line no-console\n-  console.log(message);\n+  console.log(JSON.stringify(payload));\n }\n \n export function requestMeta(req: Request): Record<string, unknown> {\n-  return { method: req.method, path: req.path };\n+  const anyReq = req as Request & { requestId?: string };\n+  return {\n+    requestId: anyReq.requestId,\n+    method: req.method,\n+    path: req.path,\n+  };\n }\n+\ndiff --git a/samples/realistic-pr-sim/src/lib/requestId.ts b/samples/realistic-pr-sim/src/lib/requestId.ts\nnew file mode 100644\nindex 0000000..53dcb31\n--- /dev/null\n+++ b/samples/realistic-pr-sim/src/lib/requestId.ts\n@@ -0,0 +1,14 @@\n+import crypto from \"node:crypto\";\n+import type { NextFunction, Request, Response } from \"express\";\n+\n+export type RequestWithId = Request & { requestId?: string };\n+\n+export function requestIdMiddleware(req: RequestWithId, _res: Response, next: NextFunction): void {\n+  // Prefer crypto.randomUUID() when available, fall back to random bytes.\n+  req.requestId =\n+    typeof crypto.randomUUID === \"function\"\n+      ? crypto.randomUUID()\n+      : crypto.randomBytes(16).toString(\"hex\");\n+  next();\n+}\n+\ndiff --git a/samples/realistic-pr-sim/src/lib/validate.ts b/samples/realistic-pr-sim/src/lib/validate.ts\nindex 8a4ff8e..8b90e1c 100644\n--- a/samples/realistic-pr-sim/src/lib/validate.ts\n+++ b/samples/realistic-pr-sim/src/lib/validate.ts\n@@ -1,10 +1,26 @@\n export function parseIntStrict(value: string, fallback: number): number {\n-  const n = Number(value);\n-  return Number.isInteger(n) ? n : fallback;\n+  const trimmed = value.trim();\n+  if (trimmed === \"\") return fallback;\n+  const n = Number(trimmed);\n+  if (!Number.isInteger(n)) return fallback;\n+  return n;\n+}\n+\n+export function clamp(value: number, min: number, max: number): number {\n+  if (Number.isNaN(value)) return min;\n+  return Math.max(min, Math.min(max, value));\n }\n \n export function ensureNonEmpty(value: unknown, field: string): string {\n-  if (typeof value !== \"string\") throw new Error(field + \": must be string\");\n-  if (!value) throw new Error(field + \": required\");\n-  return value;\n+  if (typeof value !== \"string\") throw new Error(`${field}: must be string`);\n+  const trimmed = value.trim();\n+  if (!trimmed) throw new Error(`${field}: required`);\n+  return trimmed;\n }\n+\n+export function ensureEmail(value: unknown, field: string): string {\n+  const email = ensureNonEmpty(value, field);\n+  if (!email.includes(\"@\") || email.includes(\" \")) throw new Error(`${field}: invalid email`);\n+  return email.toLowerCase();\n+}\n+\ndiff --git a/samples/realistic-pr-sim/src/routes/auth.ts b/samples/realistic-pr-sim/src/routes/auth.ts\nindex 83b6bc8..a7a2a37 100644\n--- a/samples/realistic-pr-sim/src/routes/auth.ts\n+++ b/samples/realistic-pr-sim/src/routes/auth.ts\n@@ -1,12 +1,42 @@\n import type { Request, Response } from \"express\";\n-import { ensureNonEmpty } from \"../lib/validate.js\";\n+import { ensureEmail, ensureNonEmpty } from \"../lib/validate.js\";\n+import { log, requestMeta } from \"../lib/logger.js\";\n+\n+const attemptsByIp = new Map<string, { count: number; resetAt: number }>();\n+\n+function allowLoginAttempt(ip: string): boolean {\n+  const now = Date.now();\n+  const windowMs = 10_000;\n+  const maxAttempts = 5;\n+  const current = attemptsByIp.get(ip);\n+  if (!current || current.resetAt < now) {\n+    attemptsByIp.set(ip, { count: 1, resetAt: now + windowMs });\n+    return true;\n+  }\n+  current.count += 1;\n+  return current.count <= maxAttempts;\n+}\n \n export function postLogin(req: Request, res: Response): void {\n-  const email = ensureNonEmpty((req.body || {}).email, \"email\");\n-  const password = ensureNonEmpty((req.body || {}).password, \"password\");\n-  if (password.length < 8) {\n-    res.status(401).json({ error: \"invalid_credentials\" });\n+  const ip = req.ip || \"unknown\";\n+  if (!allowLoginAttempt(ip)) {\n+    log(\"warn\", \"rate_limited\", { ...requestMeta(req), ip });\n+    res.status(429).json({ error: \"too_many_attempts\" });\n     return;\n   }\n-  res.json({ token: `fake-jwt-for:${String(email).toLowerCase()}` });\n+\n+  try {\n+    const email = ensureEmail((req.body || {}).email, \"email\");\n+    const password = ensureNonEmpty((req.body || {}).password, \"password\");\n+    const ok = password.length >= 8;\n+    if (!ok) {\n+      res.status(401).json({ error: \"invalid_credentials\" });\n+      return;\n+    }\n+    res.json({ token: `fake-jwt-for:${email}` });\n+  } catch (err) {\n+    log(\"info\", \"bad_request\", { ...requestMeta(req), err: String(err) });\n+    res.status(400).json({ error: \"bad_request\" });\n+  }\n }\n+\ndiff --git a/samples/realistic-pr-sim/src/routes/tasks.ts b/samples/realistic-pr-sim/src/routes/tasks.ts\nindex 6d846ae..8bbce0e 100644\n--- a/samples/realistic-pr-sim/src/routes/tasks.ts\n+++ b/samples/realistic-pr-sim/src/routes/tasks.ts\n@@ -1,6 +1,13 @@\n import type { Request, Response } from \"express\";\n import { listTasks } from \"../db/index.js\";\n+import { clamp, parseIntStrict } from \"../lib/validate.js\";\n \n-export function getTasks(_req: Request, res: Response): void {\n-  res.json({ items: listTasks(), nextCursor: null });\n+export function getTasks(req: Request, res: Response): void {\n+  const rawLimit = String(req.query.limit ?? \"20\");\n+  const limit = clamp(parseIntStrict(rawLimit, 20), 1, 100);\n+  const cursor = typeof req.query.cursor === \"string\" ? req.query.cursor : null;\n+\n+  const result = listTasks({ limit, cursor });\n+  res.json(result);\n }\n+\ndiff --git a/samples/realistic-pr-sim/src/server.ts b/samples/realistic-pr-sim/src/server.ts\nindex a6eebb3..e9dd1cf 100644\n--- a/samples/realistic-pr-sim/src/server.ts\n+++ b/samples/realistic-pr-sim/src/server.ts\n@@ -1,19 +1,45 @@\n import express from \"express\";\n+import { requestIdMiddleware } from \"./lib/requestId.js\";\n+import { log, requestMeta } from \"./lib/logger.js\";\n import { getTasks } from \"./routes/tasks.js\";\n import { postLogin } from \"./routes/auth.js\";\n \n export function buildApp() {\n   const app = express();\n-  app.use(express.json());\n+  app.disable(\"x-powered-by\");\n+\n+  app.use(express.json({ limit: \"64kb\" }));\n+  app.use(requestIdMiddleware);\n+  app.use((req, res, next) => {\n+    const start = Date.now();\n+    res.on(\"finish\", () => {\n+      log(\"info\", \"request\", { ...requestMeta(req), status: res.statusCode, ms: Date.now() - start });\n+    });\n+    next();\n+  });\n \n   app.get(\"/health\", (_req, res) => res.json({ ok: true }));\n   app.post(\"/auth/login\", postLogin);\n   app.get(\"/tasks\", getTasks);\n \n+  app.use((err: unknown, req: express.Request, res: express.Response, _next: express.NextFunction) => {\n+    log(\"error\", \"unhandled_error\", { ...requestMeta(req), err: String(err) });\n+    res.status(500).json({ error: \"internal_error\" });\n+  });\n+\n   return app;\n }\n \n export async function startServer(port: number): Promise<void> {\n   const app = buildApp();\n-  app.listen(port);\n+  const server = app.listen(port);\n+  log(\"info\", \"listening\", { port });\n+\n+  const shutdown = async (signal: string) => {\n+    log(\"warn\", \"shutdown\", { signal });\n+    server.close();\n+  };\n+  process.on(\"SIGINT\", () => void shutdown(\"SIGINT\"));\n+  process.on(\"SIGTERM\", () => void shutdown(\"SIGTERM\"));\n }\n+\ndiff --git a/samples/realistic-pr-sim/src/ui/components/Toast.tsx b/samples/realistic-pr-sim/src/ui/components/Toast.tsx\nnew file mode 100644\nindex 0000000..23d75f9\n--- /dev/null\n+++ b/samples/realistic-pr-sim/src/ui/components/Toast.tsx\n@@ -0,0 +1,21 @@\n+import React from \"react\";\n+\n+export type ToastVariant = \"success\" | \"error\" | \"info\";\n+\n+export function Toast(props: { variant: ToastVariant; message: string; onClose: () => void }) {\n+  const { variant, message, onClose } = props;\n+  React.useEffect(() => {\n+    const id = window.setTimeout(() => onClose(), 3000);\n+    return () => window.clearTimeout(id);\n+  }, [onClose]);\n+\n+  return (\n+    <div role=\"status\" data-variant={variant}>\n+      <span>{message}</span>\n+      <button type=\"button\" onClick={onClose}>\n+        Close\n+      </button>\n+    </div>\n+  );\n+}\n+\ndiff --git a/samples/realistic-pr-sim/src/ui/pages/SettingsPage.tsx b/samples/realistic-pr-sim/src/ui/pages/SettingsPage.tsx\nindex b64de5f..72774c8 100644\n--- a/samples/realistic-pr-sim/src/ui/pages/SettingsPage.tsx\n+++ b/samples/realistic-pr-sim/src/ui/pages/SettingsPage.tsx\n@@ -1,7 +1,23 @@\n import React from \"react\";\n+import { Toast } from \"../components/Toast.js\";\n \n export function SettingsPage() {\n   const [enableAnalytics, setEnableAnalytics] = React.useState(false);\n+  const [saving, setSaving] = React.useState(false);\n+  const [toast, setToast] = React.useState<null | { variant: \"success\" | \"error\"; message: string }>(null);\n+\n+  const save = async () => {\n+    setSaving(true);\n+    try {\n+      // Pretend to persist settings.\n+      await new Promise((r) => window.setTimeout(r, 150));\n+      setToast({ variant: \"success\", message: \"Saved\" });\n+    } catch {\n+      setToast({ variant: \"error\", message: \"Save failed\" });\n+    } finally {\n+      setSaving(false);\n+    }\n+  };\n \n   return (\n     <section>\n@@ -14,6 +30,14 @@ export function SettingsPage() {\n         />\n         Enable analytics\n       </label>\n+      <div>\n+        <button type=\"button\" onClick={save} disabled={saving}>\n+          {saving ? \"Saving...\" : \"Save\"}\n+        </button>\n+      </div>\n+\n+      {toast ? <Toast variant={toast.variant} message={toast.message} onClose={() => setToast(null)} /> : null}\n     </section>\n   );\n }\n+\ndiff --git a/samples/realistic-pr-sim/tests/routes.test.ts b/samples/realistic-pr-sim/tests/routes.test.ts\nnew file mode 100644\nindex 0000000..2f68b8b\n--- /dev/null\n+++ b/samples/realistic-pr-sim/tests/routes.test.ts\n@@ -0,0 +1,10 @@\n+import assert from \"node:assert/strict\";\n+import test from \"node:test\";\n+\n+test(\"smoke: list tasks shape\", async () => {\n+  // Sample test file used for diffs; not executed in this repo.\n+  const body = { items: [{ id: \"t-001\", title: \"x\", completed: false }], nextCursor: null };\n+  assert.equal(Array.isArray(body.items), true);\n+  assert.equal(typeof body.nextCursor === \"string\" || body.nextCursor === null, true);\n+});\n+\n"
}
